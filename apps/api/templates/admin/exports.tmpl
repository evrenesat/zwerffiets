{{define "content"}}
<section class="card">
  <h1>{{index .Text "exports_title"}}</h1>

  <form method="post" action="/bikeadmin/exports/generate" class="inline-form export-generate">
    <label for="period_type">{{index .Text "exports_period"}}</label>
    <select id="period_type" name="period_type">
      <option value="weekly" {{if eq .SelectedPeriod "weekly"}}selected{{end}}>{{index .Text "exports_weekly"}}</option>
      <option value="monthly" {{if eq .SelectedPeriod "monthly"}}selected{{end}}>{{index .Text "exports_monthly"}}</option>
      <option value="all" {{if eq .SelectedPeriod "all"}}selected{{end}}>{{index .Text "exports_all_time"}}</option>
    </select>

    <label for="status">{{index .Text "filter_status"}}</label>
    <select id="status" name="status">
      <option value="">{{index .Text "filter_all"}}</option>
      {{range .Statuses}}
      <option value="{{.}}">{{index $.Text (printf "status_%s" .)}}</option>
      {{end}}
    </select>

    {{if .Municipalities}}
    <label for="municipality">{{index .Text "report_municipality"}}</label>
    <select id="municipality" name="municipality">
      <option value="">{{index .Text "filter_all"}}</option>
      {{range .Municipalities}}
      <option value="{{.}}">{{.}}</option>
      {{end}}
    </select>
    {{end}}

    <button type="submit">{{index .Text "exports_generate"}}</button>
  </form>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>{{index .Text "exports_col_generated"}}</th>
          <th>{{index .Text "exports_col_type"}}</th>
          <th>{{index .Text "exports_col_period"}}</th>
          <th>{{index .Text "exports_col_rows"}}</th>
          <th>{{index .Text "exports_col_files"}}</th>
        </tr>
      </thead>
      <tbody>
        {{range $row := .Exports}}
        <tr>
          <td>{{$row.GeneratedAt}}</td>
          <td>
        {{$row.PeriodType}}
        {{if $row.FilterStatus}}<br><span class="badge" style="font-size: 0.8em; background: #eee; padding: 2px 4px; border-radius: 4px;">Status: {{$row.FilterStatus}}</span>{{end}}
        {{if $row.FilterMunicipality}}<br><span class="badge" style="font-size: 0.8em; background: #eee; padding: 2px 4px; border-radius: 4px;">Gemeente: {{$row.FilterMunicipality}}</span>{{end}}
      </td>
          <td>{{$row.PeriodRange}}</td>
          <td>{{$row.RowCount}}</td>
          <td>
            <a href="/api/v1/operator/exports/{{$row.ID}}/download?format=csv">CSV</a>
            |
            <a href="/api/v1/operator/exports/{{$row.ID}}/download?format=geojson">GeoJSON</a>
            |
            <a href="/api/v1/operator/exports/{{$row.ID}}/download?format=pdf">PDF</a>
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
  </div>
</section>
{{end}}
